
#!/bin/bash -e
set -o xtrace
TESTRUN_OUT=/tmp/testrun.log


sudo ip link add dummy0 type dummy

# Setup requirements
sudo apt-get update
sudo apt-get install openvswitch-common openvswitch-switch  isc-dhcp-client

gateway=$(ip route | head -n 1 | awk '{print $3}')
ip4=$(ip a show eth0 | grep "inet " | awk '{{print $2}}')


sudo /usr/share/openvswitch/scripts/ovs-ctl start
sleep 1
sudo ovs-vsctl add-br br0

sudo ovs-vsctl add-port br0 eth0
sudo ip addr flush dev eth0
sudo ip addr add $ip4 dev br0
sudo ip route append default via $gateway dev br0
sudo echo "nameserver 8.8.8.8" > /etc/resolv.conf
sudo ip link set br0 up
sudo dhclient -v -i br0
echo done here
